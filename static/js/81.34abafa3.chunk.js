"use strict";(self.webpackChunkr3f_examples=self.webpackChunkr3f_examples||[]).push([[81],{8202:function(e,r,t){t.d(r,{j:function(){return d}});var n=t(1413),a=t(9439),o=t(4925),i=t(7462),u=t(2791),s=t(7760),c=t(2794),l={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n      varying vec2 vUv;\n\n      void main() {\n\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n      }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform float h;\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvec4 sum = vec4( 0.0 );\n\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n    \tgl_FragColor = sum;\n\n    }\n  "},v={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n  ",fragmentShader:"\n\n  uniform sampler2D tDiffuse;\n  uniform float v;\n\n  varying vec2 vUv;\n\n  void main() {\n\n    vec4 sum = vec4( 0.0 );\n\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n    gl_FragColor = sum;\n\n  }\n  "},f=["scale","frames","opacity","width","height","blur","far","resolution","smooth","color","depthWrite","renderOrder"],d=u.forwardRef((function(e,r){var t=e.scale,d=void 0===t?10:t,m=e.frames,h=void 0===m?1/0:m,p=e.opacity,g=void 0===p?1:p,y=e.width,x=void 0===y?1:y,b=e.height,E=void 0===b?1:b,w=e.blur,U=void 0===w?1:w,k=e.far,D=void 0===k?10:k,_=e.resolution,M=void 0===_?512:_,T=e.smooth,P=void 0===T||T,L=e.color,C=void 0===L?"#000000":L,F=e.depthWrite,R=void 0!==F&&F,S=e.renderOrder,A=(0,o.Z)(e,f),B=(0,c.w)((function(e){return e.scene})),Z=(0,c.w)((function(e){return e.gl})),H=u.useRef(null);x*=Array.isArray(d)?d[0]:d||1,E*=Array.isArray(d)?d[1]:d||1;var W=u.useMemo((function(){var e=new s.WebGLRenderTarget(M,M),r=new s.WebGLRenderTarget(M,M);r.texture.generateMipmaps=e.texture.generateMipmaps=!1;var t=new s.PlaneBufferGeometry(x,E).rotateX(Math.PI/2),a=new s.Mesh(t),o=new s.MeshDepthMaterial;o.depthTest=o.depthWrite=!1,o.onBeforeCompile=function(e){e.uniforms=(0,n.Z)((0,n.Z)({},e.uniforms),{},{ucolor:{value:new s.Color(C).convertSRGBToLinear()}}),e.fragmentShader=e.fragmentShader.replace("void main() {","uniform vec3 ucolor;\n           void main() {\n          "),e.fragmentShader=e.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor, ( 1.0 - fragCoordZ ) * 1.0 );")};var i=new s.ShaderMaterial(l),u=new s.ShaderMaterial(v);return u.depthTest=i.depthTest=!1,[e,t,o,a,i,u,r]}),[M,x,E,d,C]),j=(0,a.Z)(W,7),G=j[0],I=j[1],V=j[2],z=j[3],O=j[4],Y=j[5],q=j[6],X=function(e){z.visible=!0,z.material=O,O.uniforms.tDiffuse.value=G.texture,O.uniforms.h.value=1*e/256,Z.setRenderTarget(q),Z.render(z,H.current),z.material=Y,Y.uniforms.tDiffuse.value=q.texture,Y.uniforms.v.value=1*e/256,Z.setRenderTarget(G),Z.render(z,H.current),z.visible=!1},N=0;return(0,c.x)((function(){if(H.current&&(h===1/0||N<h)){var e=B.background;B.background=null;var r=B.overrideMaterial;B.overrideMaterial=V,Z.setRenderTarget(G),Z.render(B,H.current),B.overrideMaterial=r,X(U),P&&X(.4*U),Z.setRenderTarget(null),B.background=e,N++}})),u.createElement("group",(0,i.Z)({"rotation-x":Math.PI/2},A,{ref:r}),u.createElement("mesh",{renderOrder:S,geometry:I,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},u.createElement("meshBasicMaterial",{map:G.texture,"map-encoding":Z.outputEncoding,transparent:!0,opacity:g,depthWrite:R})),u.createElement("orthographicCamera",{ref:H,args:[-x/2,x/2,E/2,-E/2,0,D]}))}))},81:function(e,r,t){t.d(r,{H:function(){return C}});var n=t(9439),a=t(4925),o=t(7462),i=t(2791),u=t(7760),s=t(2794),c=t(5671),l=t(3144),v=t(8301),f=t(1120),d=t(136),m=t(9388),h=function(e){(0,d.Z)(t,e);var r=(0,m.Z)(t);function t(e){var n;return(0,c.Z)(this,t),(n=r.call(this,e)).type=u.HalfFloatType,n}return(0,l.Z)(t,[{key:"parse",value:function(e){var r=function(e,r){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(r||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(r||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(r||""));break;default:console.error("THREE.RGBELoader: Error: "+(r||""))}return-1},t=function(e,r,t){r=r||1024;for(var n=e.pos,a=-1,o=0,i="",u=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));0>(a=u.indexOf("\n"))&&o<r&&n<e.byteLength;)i+=u,o+=u.length,n+=128,u+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<a&&(!1!==t&&(e.pos+=o+a+1),i+u.slice(0,a))},n=function(e,r,t,n){var a=e[r+3],o=Math.pow(2,a-128)/255;t[n+0]=e[r+0]*o,t[n+1]=e[r+1]*o,t[n+2]=e[r+2]*o,t[n+3]=1},a=function(e,r,t,n){var a=e[r+3],o=Math.pow(2,a-128)/255;t[n+0]=u.DataUtils.toHalfFloat(Math.min(e[r+0]*o,65504)),t[n+1]=u.DataUtils.toHalfFloat(Math.min(e[r+1]*o,65504)),t[n+2]=u.DataUtils.toHalfFloat(Math.min(e[r+2]*o,65504)),t[n+3]=u.DataUtils.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;var i=function(e){var n,a,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,u=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(n=t(e)))return r(1,"no header found");if(!(a=n.match(/^#\?(\S+)/)))return r(3,"bad initial token");for(c.valid|=1,c.programtype=a[1],c.string+=n+"\n";!1!==(n=t(e));)if(c.string+=n+"\n","#"!==n.charAt(0)){if((a=n.match(o))&&(c.gamma=parseFloat(a[1])),(a=n.match(i))&&(c.exposure=parseFloat(a[1])),(a=n.match(u))&&(c.valid|=2,c.format=a[1]),(a=n.match(s))&&(c.valid|=4,c.height=parseInt(a[1],10),c.width=parseInt(a[2],10)),2&c.valid&&4&c.valid)break}else c.comments+=n+"\n";return 2&c.valid?4&c.valid?c:r(3,"missing image size specifier"):r(3,"missing format specifier")}(o);if(-1!==i){var s=i.width,c=i.height,l=function(e,t,n){var a=t;if(a<8||a>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(a!==(e[2]<<8|e[3]))return r(3,"wrong scanline width");var o=new Uint8Array(4*t*n);if(!o.length)return r(4,"unable to allocate buffer space");for(var i=0,u=0,s=4*a,c=new Uint8Array(4),l=new Uint8Array(s),v=n;v>0&&u<e.byteLength;){if(u+4>e.byteLength)return r(1);if(c[0]=e[u++],c[1]=e[u++],c[2]=e[u++],c[3]=e[u++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=a)return r(3,"bad rgbe scanline format");for(var f=0,d=void 0;f<s&&u<e.byteLength;){var m=(d=e[u++])>128;if(m&&(d-=128),0===d||f+d>s)return r(3,"bad scanline data");if(m)for(var h=e[u++],p=0;p<d;p++)l[f++]=h;else l.set(e.subarray(u,u+d),f),f+=d,u+=d}for(var g=a,y=0;y<g;y++){var x=0;o[i]=l[y+x],x+=a,o[i+1]=l[y+x],x+=a,o[i+2]=l[y+x],x+=a,o[i+3]=l[y+x],i+=4}v--}return o}(o.subarray(o.pos),s,c);if(-1!==l){var v,f,d;switch(this.type){case u.FloatType:d=l.length/4;for(var m=new Float32Array(4*d),h=0;h<d;h++)n(l,4*h,m,4*h);v=m,f=u.FloatType;break;case u.HalfFloatType:d=l.length/4;for(var p=new Uint16Array(4*d),g=0;g<d;g++)a(l,4*g,p,4*g);v=p,f=u.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:s,height:c,data:v,header:i.string,gamma:i.gamma,exposure:i.exposure,format:undefined,type:f}}}return null}},{key:"setDataType",value:function(e){return this.type=e,this}},{key:"load",value:function(e,r,n,a){return(0,v.Z)((0,f.Z)(t.prototype),"load",this).call(this,e,(function(e,t){switch(e.type){case u.FloatType:case u.HalfFloatType:e.encoding=u.LinearEncoding,e.minFilter=u.LinearFilter,e.magFilter=u.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}r&&r(e,t)}),n,a)}}]),t}(u.DataTextureLoader),p={sunset:"venice/venice_sunset_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",night:"dikhololo/dikhololo_night_1k.hdr",warehouse:"empty-wharehouse/empty_warehouse_01_1k.hdr",forest:"forrest-slope/forest_slope_1k.hdr",apartment:"lebombo/lebombo_1k.hdr",studio:"studio-small-3/studio_small_03_1k.hdr",city:"potsdamer-platz/potsdamer_platz_1k.hdr",park:"rooitou/rooitou_park_1k.hdr",lobby:"st-fagans/st_fagans_interior_1k.hdr"},g=["args","children"];function y(e){var r=e+"BufferGeometry";return i.forwardRef((function(e,t){var n=e.args,u=e.children,s=(0,a.Z)(e,g);return i.createElement("mesh",(0,o.Z)({ref:t},s),i.createElement(r,{attach:"geometry",args:n}),u)}))}y("box"),y("circle"),y("cone"),y("cylinder"),y("sphere"),y("plane"),y("tube"),y("torus"),y("torusKnot"),y("tetrahedron"),y("ring"),y("polyhedron");var x=y("icosahedron"),b=(y("octahedron"),y("dodecahedron"),y("extrude"),y("lathe"),["background","scene"]),E=function(e){return(r=e).current&&r.current.isScene?e.current:e;var r};function w(e){var r=e.scene,t=e.background,n=void 0!==t&&t,a=e.map,o=(0,s.w)((function(e){return e.scene}));return i.useLayoutEffect((function(){if(a){var e=E(r||o),t=e.background,i=e.environment;return"only"!==n&&(e.environment=a),n&&(e.background=a),function(){"only"!==n&&(e.environment=i),n&&(e.background=t)}}}),[o,r,a,n]),null}function U(e){var r=e.files,t=void 0===r?["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"]:r,n=e.path,a=void 0===n?"":n,o=e.preset,i=void 0===o?void 0:o,c=e.extensions;if(i){if(!(i in p))throw new Error("Preset must be one of: "+Object.keys(p).join(", "));t=p[i],a="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}var l=Array.isArray(t),v=l?u.CubeTextureLoader:h,f=(0,s.z)(v,l?[t]:t,(function(e){e.setPath(a),c&&c(e)})),d=l?f[0]:f;return d.mapping=l?u.CubeReflectionMapping:u.EquirectangularReflectionMapping,d}function k(e){var r=e.background,t=void 0!==r&&r,n=e.scene,o=U((0,a.Z)(e,b)),u=(0,s.w)((function(e){return e.scene}));return i.useLayoutEffect((function(){var e=E(n||u),r=e.background,a=e.environment;return"only"!==t&&(e.environment=o),t&&(e.background=o),function(){"only"!==t&&(e.environment=a),t&&(e.background=r)}}),[o,t,n,u]),null}function D(e){var r=e.children,t=e.near,a=void 0===t?1:t,o=e.far,c=void 0===o?1e3:o,l=e.resolution,v=void 0===l?256:l,f=e.frames,d=void 0===f?1:f,m=e.map,h=e.background,p=void 0!==h&&h,g=e.scene,y=e.files,x=e.path,b=e.preset,U=void 0===b?void 0:b,D=e.extensions,_=(0,s.w)((function(e){return e.gl})),M=(0,s.w)((function(e){return e.scene})),T=i.useRef(null),P=i.useState((function(){return new u.Scene})),L=(0,n.Z)(P,1)[0],C=i.useMemo((function(){var e=new u.WebGLCubeRenderTarget(v);return e.texture.type=u.HalfFloatType,e}),[v]);i.useLayoutEffect((function(){1===d&&T.current.update(_,L);var e=E(g||M),r=e.background,t=e.environment;return"only"!==p&&(e.environment=C.texture),p&&(e.background=C.texture),function(){"only"!==p&&(e.environment=t),p&&(e.background=r)}}),[r,L,C.texture,g,M,p,d,_]);var F=1;return(0,s.x)((function(){(d===1/0||F<d)&&(T.current.update(_,L),F++)})),i.createElement(i.Fragment,null,(0,s.g)(i.createElement(i.Fragment,null,r,i.createElement("cubeCamera",{ref:T,args:[a,c,C]}),y||U?i.createElement(k,{background:!0,files:y,preset:U,path:x,extensions:D}):m?i.createElement(w,{background:!0,map:m,extensions:D}):null),L))}function _(e){var r,t,n,a,s,c=U(e),l=e.map||c,v=(s=l)&&s.isCubeTexture,f=i.useMemo((function(){var e,r,t=(null!==(e=v?null==(r=l.image[0])?void 0:r.width:l.image.width)&&void 0!==e?e:1024)/4,n=Math.floor(Math.log2(t)),a=Math.pow(2,n),o=3*Math.max(a,112),i=4*a;return[v?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH ".concat(1/o),"#define CUBEUV_TEXEL_HEIGHT ".concat(1/i),"#define CUBEUV_MAX_MIP ".concat(n,".0"),""]}),[]),d=i.useMemo((function(){return f.join("\n")+"#define GLSLIFY 1\n#define ENVMAP_TYPE_CUBE_UV\nvarying vec3 vWorldPosition;uniform float radius;uniform float height;\n#ifdef ENVMAP_TYPE_CUBE\nuniform samplerCube cubemap;\n#else\nuniform sampler2D cubemap;\n#endif\nfloat diskIntersect(in vec3 ro,in vec3 rd,vec3 c,vec3 n,float r){vec3 o=ro-c;float t=-dot(n,o)/dot(rd,n);vec3 q=o+rd*t;return(dot(q,q)<r*r)? t : 1e6;}float sphereIntersect(in vec3 ro,in vec3 rd,in vec3 ce,float ra){vec3 oc=ro-ce;float b=dot(oc,rd);float c=dot(oc,oc)-ra*ra;float h=b*b-c;if(h<0.0)-1.0;h=sqrt(h);return-b+h;}vec3 project(){vec3 p=normalize(vWorldPosition);vec3 camPos=cameraPosition;camPos.y-=height;float intersection=sphereIntersect(camPos,p,vec3(0.),radius);if(intersection>0.){vec3 h=vec3(0.0,-height,0.0);float intersection2=diskIntersect(camPos,p,h,vec3(0.0,-1.0,0.0),radius);p=(camPos+min(intersection,intersection2)*p)/radius;}else{p=vec3(0.0,1.0,0.0);}return p;}\n#include <common>\n#include <cube_uv_reflection_fragment>\nvoid main(){vec3 projectedWorldPosition=project();\n#ifdef ENVMAP_TYPE_CUBE\nvec3 outcolor=textureCube(cubemap,projectedWorldPosition).rgb;\n#else\nvec3 direction=normalize(projectedWorldPosition);vec2 uv=equirectUv(direction);vec3 outcolor=texture2D(cubemap,uv).rgb;\n#endif\ngl_FragColor=vec4(outcolor,1.0);\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n}"}),[f]),m=i.useMemo((function(){return{cubemap:{value:null},height:{value:15},radius:{value:60}}}),[]),h=i.useRef(null),p=null==(r=e.ground)?void 0:r.height,g=null==(t=e.ground)?void 0:t.radius,y=null!==(n=null==(a=e.ground)?void 0:a.scale)&&void 0!==n?n:1e3;return i.useEffect((function(){p&&(h.current.uniforms.height.value=p)}),[p]),i.useEffect((function(){g&&(h.current.uniforms.radius.value=g)}),[g]),i.useEffect((function(){h.current.uniforms.cubemap.value=l}),[l]),i.createElement(i.Fragment,null,i.createElement(w,(0,o.Z)({},e,{map:l})),i.createElement(x,{scale:y,args:[1,16]},i.createElement("shaderMaterial",{ref:h,side:u.BackSide,vertexShader:"#define GLSLIFY 1\nvarying vec3 vWorldPosition;void main(){vec4 worldPosition=modelMatrix*vec4(position,1.0);vWorldPosition=worldPosition.xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",fragmentShader:d,uniforms:m,depthTest:!1})))}function M(e){return e.ground?i.createElement(_,e):e.map?i.createElement(w,e):e.children?i.createElement(D,e):i.createElement(k,e)}var T=t(8202),P=["children","controls","shadows","adjustCamera","environment","intensity","preset","shadowBias","contactShadow"],L={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function C(e){var r=e.children,t=e.controls,c=e.shadows,l=void 0===c||c,v=e.adjustCamera,f=void 0===v||v,d=e.environment,m=void 0===d?"city":d,h=e.intensity,p=void 0===h?1:h,g=e.preset,y=void 0===g?"rembrandt":g,x=e.shadowBias,b=void 0===x?0:x,E=e.contactShadow,w=void 0===E?{blur:2,opacity:.5,position:[0,0,0]}:E,U=(0,a.Z)(e,P),k=L[y],D=(0,s.w)((function(e){return e.camera})),_=(0,s.w)((function(e){return e.controls})),C=i.useRef(null),F=i.useRef(null),R=i.useState({radius:0,width:0,height:0}),S=(0,n.Z)(R,2),A=S[0],B=A.radius,Z=A.width,H=A.height,W=S[1];return i.useLayoutEffect((function(){C.current.position.set(0,0,0),C.current.updateWorldMatrix(!0,!0);var e=(new u.Box3).setFromObject(F.current),r=new u.Vector3,t=new u.Sphere,n=e.max.y-e.min.y,a=e.max.x-e.min.x;e.getCenter(r),e.getBoundingSphere(t),W({radius:t.radius,width:a,height:n}),C.current.position.set(-r.x,-r.y+n/2,-r.z)}),[r]),i.useLayoutEffect((function(){if(f){var e=B/(H>Z?1.5:2.5);D.position.set(0,.5*B,2.5*B),D.near=.1,D.far=Math.max(5e3,4*B),D.lookAt(0,e,0);var r=_||(null==t?void 0:t.current);r&&(r.target.set(0,e,0),r.update())}}),[_,B,H,Z,f]),i.createElement("group",U,i.createElement("group",{ref:C},i.createElement("group",{ref:F},r)),w&&i.createElement(T.j,(0,o.Z)({scale:2*B,far:B/2},w)),m&&i.createElement(M,{preset:m}),i.createElement("ambientLight",{intensity:p/3}),i.createElement("spotLight",{penumbra:1,position:[k.main[0]*B,k.main[1]*B,k.main[2]*B],intensity:2*p,castShadow:l,"shadow-bias":b}),i.createElement("pointLight",{position:[k.fill[0]*B,k.fill[1]*B,k.fill[2]*B],intensity:p}))}}}]);
//# sourceMappingURL=81.34abafa3.chunk.js.map