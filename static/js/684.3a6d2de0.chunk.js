"use strict";(self.webpackChunkr3f_examples=self.webpackChunkr3f_examples||[]).push([[684],{9292:function(e,n,r){r.d(n,{qA:function(){return L}});var t=r(9439),o=r(4925),a=r(7462),i=r(2791),u=r(2794),c=r(7760),s=r(5671),l=r(3144),d=r(8301),f=r(1120),m=r(136),v=r(9388),p=function(e){(0,m.Z)(r,e);var n=(0,v.Z)(r);function r(e){var t;return(0,s.Z)(this,r),(t=n.call(this,e)).type=c.HalfFloatType,t}return(0,l.Z)(r,[{key:"parse",value:function(e){var n=function(e,n){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(n||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(n||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(n||""));break;default:console.error("THREE.RGBELoader: Error: "+(n||""))}return-1},r=function(e,n,r){n=n||1024;for(var t=e.pos,o=-1,a=0,i="",u=String.fromCharCode.apply(null,new Uint16Array(e.subarray(t,t+128)));0>(o=u.indexOf("\n"))&&a<n&&t<e.byteLength;)i+=u,a+=u.length,t+=128,u+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(t,t+128)));return-1<o&&(!1!==r&&(e.pos+=a+o+1),i+u.slice(0,o))},t=function(e,n,r,t){var o=e[n+3],a=Math.pow(2,o-128)/255;r[t+0]=e[n+0]*a,r[t+1]=e[n+1]*a,r[t+2]=e[n+2]*a,r[t+3]=1},o=function(e,n,r,t){var o=e[n+3],a=Math.pow(2,o-128)/255;r[t+0]=c.DataUtils.toHalfFloat(Math.min(e[n+0]*a,65504)),r[t+1]=c.DataUtils.toHalfFloat(Math.min(e[n+1]*a,65504)),r[t+2]=c.DataUtils.toHalfFloat(Math.min(e[n+2]*a,65504)),r[t+3]=c.DataUtils.toHalfFloat(1)},a=new Uint8Array(e);a.pos=0;var i=function(e){var t,o,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,u=/^\s*FORMAT=(\S+)\s*$/,c=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(t=r(e)))return n(1,"no header found");if(!(o=t.match(/^#\?(\S+)/)))return n(3,"bad initial token");for(s.valid|=1,s.programtype=o[1],s.string+=t+"\n";!1!==(t=r(e));)if(s.string+=t+"\n","#"!==t.charAt(0)){if((o=t.match(a))&&(s.gamma=parseFloat(o[1])),(o=t.match(i))&&(s.exposure=parseFloat(o[1])),(o=t.match(u))&&(s.valid|=2,s.format=o[1]),(o=t.match(c))&&(s.valid|=4,s.height=parseInt(o[1],10),s.width=parseInt(o[2],10)),2&s.valid&&4&s.valid)break}else s.comments+=t+"\n";return 2&s.valid?4&s.valid?s:n(3,"missing image size specifier"):n(3,"missing format specifier")}(a);if(-1!==i){var u=i.width,s=i.height,l=function(e,r,t){var o=r;if(o<8||o>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(o!==(e[2]<<8|e[3]))return n(3,"wrong scanline width");var a=new Uint8Array(4*r*t);if(!a.length)return n(4,"unable to allocate buffer space");for(var i=0,u=0,c=4*o,s=new Uint8Array(4),l=new Uint8Array(c),d=t;d>0&&u<e.byteLength;){if(u+4>e.byteLength)return n(1);if(s[0]=e[u++],s[1]=e[u++],s[2]=e[u++],s[3]=e[u++],2!=s[0]||2!=s[1]||(s[2]<<8|s[3])!=o)return n(3,"bad rgbe scanline format");for(var f=0,m=void 0;f<c&&u<e.byteLength;){var v=(m=e[u++])>128;if(v&&(m-=128),0===m||f+m>c)return n(3,"bad scanline data");if(v)for(var p=e[u++],h=0;h<m;h++)l[f++]=p;else l.set(e.subarray(u,u+m),f),f+=m,u+=m}for(var g=o,E=0;E<g;E++){var b=0;a[i]=l[E+b],b+=o,a[i+1]=l[E+b],b+=o,a[i+2]=l[E+b],b+=o,a[i+3]=l[E+b],i+=4}d--}return a}(a.subarray(a.pos),u,s);if(-1!==l){var d,f,m;switch(this.type){case c.FloatType:m=l.length/4;for(var v=new Float32Array(4*m),p=0;p<m;p++)t(l,4*p,v,4*p);d=v,f=c.FloatType;break;case c.HalfFloatType:m=l.length/4;for(var h=new Uint16Array(4*m),g=0;g<m;g++)o(l,4*g,h,4*g);d=h,f=c.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:u,height:s,data:d,header:i.string,gamma:i.gamma,exposure:i.exposure,format:undefined,type:f}}}return null}},{key:"setDataType",value:function(e){return this.type=e,this}},{key:"load",value:function(e,n,t,o){return(0,d.Z)((0,f.Z)(r.prototype),"load",this).call(this,e,(function(e,r){switch(e.type){case c.FloatType:case c.HalfFloatType:e.encoding=c.LinearEncoding,e.minFilter=c.LinearFilter,e.magFilter=c.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}n&&n(e,r)}),t,o)}}]),r}(c.DataTextureLoader),h={sunset:"venice/venice_sunset_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",night:"dikhololo/dikhololo_night_1k.hdr",warehouse:"empty-wharehouse/empty_warehouse_01_1k.hdr",forest:"forrest-slope/forest_slope_1k.hdr",apartment:"lebombo/lebombo_1k.hdr",studio:"studio-small-3/studio_small_03_1k.hdr",city:"potsdamer-platz/potsdamer_platz_1k.hdr",park:"rooitou/rooitou_park_1k.hdr",lobby:"st-fagans/st_fagans_interior_1k.hdr"},g=r(7459),E=["background","scene"],b=function(e){return(n=e).current&&n.current.isScene?e.current:e;var n};function y(e){var n=e.scene,r=e.background,t=void 0!==r&&r,o=e.map,a=(0,u.w)((function(e){return e.scene}));return i.useLayoutEffect((function(){if(o){var e=b(n||a),r=e.background,i=e.environment;return"only"!==t&&(e.environment=o),t&&(e.background=o),function(){"only"!==t&&(e.environment=i),t&&(e.background=r)}}}),[a,n,o,t]),null}function k(e){var n=e.files,r=void 0===n?["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"]:n,t=e.path,o=void 0===t?"":t,a=e.preset,i=void 0===a?void 0:a,s=e.extensions;if(i){if(!(i in h))throw new Error("Preset must be one of: "+Object.keys(h).join(", "));r=h[i],o="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}var l=Array.isArray(r),d=l?c.CubeTextureLoader:p,f=(0,u.z)(d,l?[r]:r,(function(e){e.setPath(o),s&&s(e)})),m=l?f[0]:f;return m.mapping=l?c.CubeReflectionMapping:c.EquirectangularReflectionMapping,m}function w(e){var n=e.background,r=void 0!==n&&n,t=e.scene,a=k((0,o.Z)(e,E)),c=(0,u.w)((function(e){return e.scene}));return i.useLayoutEffect((function(){var e=b(t||c),n=e.background,o=e.environment;return"only"!==r&&(e.environment=a),r&&(e.background=a),function(){"only"!==r&&(e.environment=o),r&&(e.background=n)}}),[a,r,t,c]),null}function _(e){var n=e.children,r=e.near,o=void 0===r?1:r,a=e.far,s=void 0===a?1e3:a,l=e.resolution,d=void 0===l?256:l,f=e.frames,m=void 0===f?1:f,v=e.map,p=e.background,h=void 0!==p&&p,g=e.scene,E=e.files,k=e.path,_=e.preset,x=void 0===_?void 0:_,L=e.extensions,F=(0,u.w)((function(e){return e.gl})),M=(0,u.w)((function(e){return e.scene})),P=i.useRef(null),T=i.useState((function(){return new c.Scene})),C=(0,t.Z)(T,1)[0],U=i.useMemo((function(){var e=new c.WebGLCubeRenderTarget(d);return e.texture.type=c.HalfFloatType,e}),[d]);i.useLayoutEffect((function(){1===m&&P.current.update(F,C);var e=b(g||M),n=e.background,r=e.environment;return"only"!==h&&(e.environment=U.texture),h&&(e.background=U.texture),function(){"only"!==h&&(e.environment=r),h&&(e.background=n)}}),[n,C,U.texture,g,M,h,m,F]);var A=1;return(0,u.x)((function(){(m===1/0||A<m)&&(P.current.update(F,C),A++)})),i.createElement(i.Fragment,null,(0,u.g)(i.createElement(i.Fragment,null,n,i.createElement("cubeCamera",{ref:P,args:[o,s,U]}),E||x?i.createElement(w,{background:!0,files:E,preset:x,path:k,extensions:L}):v?i.createElement(y,{background:!0,map:v,extensions:L}):null),C))}function x(e){var n,r,t,o,u,s=k(e),l=e.map||s,d=(u=l)&&u.isCubeTexture,f=i.useMemo((function(){var e,n,r=(null!==(e=d?null==(n=l.image[0])?void 0:n.width:l.image.width)&&void 0!==e?e:1024)/4,t=Math.floor(Math.log2(r)),o=Math.pow(2,t),a=3*Math.max(o,112),i=4*o;return[d?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH ".concat(1/a),"#define CUBEUV_TEXEL_HEIGHT ".concat(1/i),"#define CUBEUV_MAX_MIP ".concat(t,".0"),""]}),[]),m=i.useMemo((function(){return f.join("\n")+"#define GLSLIFY 1\n#define ENVMAP_TYPE_CUBE_UV\nvarying vec3 vWorldPosition;uniform float radius;uniform float height;\n#ifdef ENVMAP_TYPE_CUBE\nuniform samplerCube cubemap;\n#else\nuniform sampler2D cubemap;\n#endif\nfloat diskIntersect(in vec3 ro,in vec3 rd,vec3 c,vec3 n,float r){vec3 o=ro-c;float t=-dot(n,o)/dot(rd,n);vec3 q=o+rd*t;return(dot(q,q)<r*r)? t : 1e6;}float sphereIntersect(in vec3 ro,in vec3 rd,in vec3 ce,float ra){vec3 oc=ro-ce;float b=dot(oc,rd);float c=dot(oc,oc)-ra*ra;float h=b*b-c;if(h<0.0)-1.0;h=sqrt(h);return-b+h;}vec3 project(){vec3 p=normalize(vWorldPosition);vec3 camPos=cameraPosition;camPos.y-=height;float intersection=sphereIntersect(camPos,p,vec3(0.),radius);if(intersection>0.){vec3 h=vec3(0.0,-height,0.0);float intersection2=diskIntersect(camPos,p,h,vec3(0.0,-1.0,0.0),radius);p=(camPos+min(intersection,intersection2)*p)/radius;}else{p=vec3(0.0,1.0,0.0);}return p;}\n#include <common>\n#include <cube_uv_reflection_fragment>\nvoid main(){vec3 projectedWorldPosition=project();\n#ifdef ENVMAP_TYPE_CUBE\nvec3 outcolor=textureCube(cubemap,projectedWorldPosition).rgb;\n#else\nvec3 direction=normalize(projectedWorldPosition);vec2 uv=equirectUv(direction);vec3 outcolor=texture2D(cubemap,uv).rgb;\n#endif\ngl_FragColor=vec4(outcolor,1.0);\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n}"}),[f]),v=i.useMemo((function(){return{cubemap:{value:null},height:{value:15},radius:{value:60}}}),[]),p=i.useRef(null),h=null==(n=e.ground)?void 0:n.height,E=null==(r=e.ground)?void 0:r.radius,b=null!==(t=null==(o=e.ground)?void 0:o.scale)&&void 0!==t?t:1e3;return i.useEffect((function(){h&&(p.current.uniforms.height.value=h)}),[h]),i.useEffect((function(){E&&(p.current.uniforms.radius.value=E)}),[E]),i.useEffect((function(){p.current.uniforms.cubemap.value=l}),[l]),i.createElement(i.Fragment,null,i.createElement(y,(0,a.Z)({},e,{map:l})),i.createElement(g.FC,{scale:b,args:[1,16]},i.createElement("shaderMaterial",{ref:p,side:c.BackSide,vertexShader:"#define GLSLIFY 1\nvarying vec3 vWorldPosition;void main(){vec4 worldPosition=modelMatrix*vec4(position,1.0);vWorldPosition=worldPosition.xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",fragmentShader:m,uniforms:v,depthTest:!1})))}function L(e){return e.ground?i.createElement(x,e):e.map?i.createElement(y,e):e.children?i.createElement(_,e):i.createElement(w,e)}},4637:function(e,n,r){r.d(n,{z:function(){return s}});var t=r(4925),o=r(7462),a=r(2794),i=r(2791),u=r(233),c=["makeDefault","camera","regress","domElement","enableDamping","onChange","onStart","onEnd"],s=i.forwardRef((function(e,n){var r=e.makeDefault,s=e.camera,l=e.regress,d=e.domElement,f=e.enableDamping,m=void 0===f||f,v=e.onChange,p=e.onStart,h=e.onEnd,g=(0,t.Z)(e,c),E=(0,a.w)((function(e){return e.invalidate})),b=(0,a.w)((function(e){return e.camera})),y=(0,a.w)((function(e){return e.gl})),k=(0,a.w)((function(e){return e.events})),w=(0,a.w)((function(e){return e.set})),_=(0,a.w)((function(e){return e.get})),x=(0,a.w)((function(e){return e.performance})),L=s||b,F=d||k.connected||y.domElement,M=i.useMemo((function(){return new u.z(L)}),[L]);return(0,a.x)((function(){M.enabled&&M.update()}),-1),i.useEffect((function(){return M.connect(F),function(){M.dispose()}}),[F,l,M,E]),i.useEffect((function(){var e=function(e){E(),l&&x.regress(),v&&v(e)};return M.addEventListener("change",e),p&&M.addEventListener("start",p),h&&M.addEventListener("end",h),function(){p&&M.removeEventListener("start",p),h&&M.removeEventListener("end",h),M.removeEventListener("change",e)}}),[v,p,h]),i.useEffect((function(){if(r){var e=_().controls;return w({controls:M}),function(){return w({controls:e})}}}),[r,M]),i.createElement("primitive",(0,o.Z)({ref:n,object:M,enableDamping:m},g))}))},7459:function(e,n,r){r.d(n,{FC:function(){return s},JO:function(){return c}});var t=r(4925),o=r(7462),a=r(2791),i=["args","children"];function u(e){var n=e+"BufferGeometry";return a.forwardRef((function(e,r){var u=e.args,c=e.children,s=(0,t.Z)(e,i);return a.createElement("mesh",(0,o.Z)({ref:r},s),a.createElement(n,{attach:"geometry",args:u}),c)}))}u("box"),u("circle"),u("cone"),u("cylinder"),u("sphere");var c=u("plane"),s=(u("tube"),u("torus"),u("torusKnot"),u("tetrahedron"),u("ring"),u("polyhedron"),u("icosahedron"));u("octahedron"),u("dodecahedron"),u("extrude"),u("lathe")}}]);
//# sourceMappingURL=684.3a6d2de0.chunk.js.map